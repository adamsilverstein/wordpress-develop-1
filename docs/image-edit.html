<!DOCTYPE html>

<html>
<head>
  <title>image-edit.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="bookmarklet.html">
                  bookmarklet.js
                </a>
              
                
                <a class="source" href="bookmarklet.min.html">
                  bookmarklet.min.js
                </a>
              
                
                <a class="source" href="color-picker.html">
                  color-picker.js
                </a>
              
                
                <a class="source" href="comment.html">
                  comment.js
                </a>
              
                
                <a class="source" href="common.html">
                  common.js
                </a>
              
                
                <a class="source" href="custom-background.html">
                  custom-background.js
                </a>
              
                
                <a class="source" href="custom-header.html">
                  custom-header.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-nav-menus.html">
                  customize-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-widgets.html">
                  customize-widgets.js
                </a>
              
                
                <a class="source" href="dashboard.html">
                  dashboard.js
                </a>
              
                
                <a class="source" href="edit-comments.html">
                  edit-comments.js
                </a>
              
                
                <a class="source" href="editor-expand.html">
                  editor-expand.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="farbtastic.html">
                  farbtastic.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="image-edit.html">
                  image-edit.js
                </a>
              
                
                <a class="source" href="inline-edit-post.html">
                  inline-edit-post.js
                </a>
              
                
                <a class="source" href="inline-edit-tax.html">
                  inline-edit-tax.js
                </a>
              
                
                <a class="source" href="iris.min.html">
                  iris.min.js
                </a>
              
                
                <a class="source" href="language-chooser.html">
                  language-chooser.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="media-gallery.html">
                  media-gallery.js
                </a>
              
                
                <a class="source" href="media-upload.html">
                  media-upload.js
                </a>
              
                
                <a class="source" href="media.html">
                  media.js
                </a>
              
                
                <a class="source" href="nav-menu.html">
                  nav-menu.js
                </a>
              
                
                <a class="source" href="password-strength-meter.html">
                  password-strength-meter.js
                </a>
              
                
                <a class="source" href="plugin-install.html">
                  plugin-install.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="postbox.html">
                  postbox.js
                </a>
              
                
                <a class="source" href="press-this.html">
                  press-this.js
                </a>
              
                
                <a class="source" href="revisions.html">
                  revisions.js
                </a>
              
                
                <a class="source" href="set-post-thumbnail.html">
                  set-post-thumbnail.js
                </a>
              
                
                <a class="source" href="svg-painter.html">
                  svg-painter.js
                </a>
              
                
                <a class="source" href="tags-box.html">
                  tags-box.js
                </a>
              
                
                <a class="source" href="tags-suggest.html">
                  tags-suggest.js
                </a>
              
                
                <a class="source" href="tags.html">
                  tags.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="updates.html">
                  updates.js
                </a>
              
                
                <a class="source" href="user-profile.html">
                  user-profile.js
                </a>
              
                
                <a class="source" href="user-suggest.html">
                  user-suggest.js
                </a>
              
                
                <a class="source" href="widgets.html">
                  widgets.js
                </a>
              
                
                <a class="source" href="media-audio-widget.html">
                  media-audio-widget.js
                </a>
              
                
                <a class="source" href="media-image-widget.html">
                  media-image-widget.js
                </a>
              
                
                <a class="source" href="media-video-widget.html">
                  media-video-widget.js
                </a>
              
                
                <a class="source" href="media-widgets.html">
                  media-widgets.js
                </a>
              
                
                <a class="source" href="text-widgets.html">
                  text-widgets.js
                </a>
              
                
                <a class="source" href="word-count.html">
                  word-count.js
                </a>
              
                
                <a class="source" href="wp-fullscreen-stub.html">
                  wp-fullscreen-stub.js
                </a>
              
                
                <a class="source" href="xfn.html">
                  xfn.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="theme-options.html">
                  theme-options.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="showcase.html">
                  showcase.js
                </a>
              
                
                <a class="source" href="color-scheme-control.html">
                  color-scheme-control.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="customizer.html">
                  customizer.js
                </a>
              
                
                <a class="source" href="featured-content-admin.html">
                  featured-content-admin.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="jquery.scrollTo.html">
                  jquery.scrollTo.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="admin-bar.html">
                  admin-bar.js
                </a>
              
                
                <a class="source" href="autosave.html">
                  autosave.js
                </a>
              
                
                <a class="source" href="backbone.html">
                  backbone.js
                </a>
              
                
                <a class="source" href="backbone.min.html">
                  backbone.min.js
                </a>
              
                
                <a class="source" href="colorpicker.html">
                  colorpicker.js
                </a>
              
                
                <a class="source" href="comment-reply.html">
                  comment-reply.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-base.html">
                  customize-base.js
                </a>
              
                
                <a class="source" href="customize-loader.html">
                  customize-loader.js
                </a>
              
                
                <a class="source" href="customize-models.html">
                  customize-models.js
                </a>
              
                
                <a class="source" href="customize-preview-nav-menus.html">
                  customize-preview-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-preview-widgets.html">
                  customize-preview-widgets.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="customize-selective-refresh.html">
                  customize-selective-refresh.js
                </a>
              
                
                <a class="source" href="customize-views.html">
                  customize-views.js
                </a>
              
                
                <a class="source" href="heartbeat.html">
                  heartbeat.js
                </a>
              
                
                <a class="source" href="hoverIntent.html">
                  hoverIntent.js
                </a>
              
                
                <a class="source" href="imagesloaded.min.html">
                  imagesloaded.min.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.html">
                  jquery.imgareaselect.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.min.html">
                  jquery.imgareaselect.min.js
                </a>
              
                
                <a class="source" href="jquery.Jcrop.min.html">
                  jquery.Jcrop.min.js
                </a>
              
                
                <a class="source" href="jquery-migrate.html">
                  jquery-migrate.js
                </a>
              
                
                <a class="source" href="jquery-migrate.min.html">
                  jquery-migrate.min.js
                </a>
              
                
                <a class="source" href="jquery.color.min.html">
                  jquery.color.min.js
                </a>
              
                
                <a class="source" href="jquery.form.html">
                  jquery.form.js
                </a>
              
                
                <a class="source" href="jquery.form.min.html">
                  jquery.form.min.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.html">
                  jquery.hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.min.html">
                  jquery.hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.html">
                  jquery.js
                </a>
              
                
                <a class="source" href="jquery.masonry.html">
                  jquery.masonry.js
                </a>
              
                
                <a class="source" href="jquery.masonry.min.html">
                  jquery.masonry.min.js
                </a>
              
                
                <a class="source" href="jquery.query.html">
                  jquery.query.js
                </a>
              
                
                <a class="source" href="jquery.schedule.html">
                  jquery.schedule.js
                </a>
              
                
                <a class="source" href="jquery.serialize-object.html">
                  jquery.serialize-object.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.html">
                  jquery.table-hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.min.html">
                  jquery.table-hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.html">
                  jquery.ui.touch-punch.js
                </a>
              
                
                <a class="source" href="suggest.html">
                  suggest.js
                </a>
              
                
                <a class="source" href="suggest.min.html">
                  suggest.min.js
                </a>
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="autocomplete.html">
                  autocomplete.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="datepicker.html">
                  datepicker.js
                </a>
              
                
                <a class="source" href="dialog.html">
                  dialog.js
                </a>
              
                
                <a class="source" href="draggable.html">
                  draggable.js
                </a>
              
                
                <a class="source" href="droppable.html">
                  droppable.js
                </a>
              
                
                <a class="source" href="effect-blind.html">
                  effect-blind.js
                </a>
              
                
                <a class="source" href="effect-bounce.html">
                  effect-bounce.js
                </a>
              
                
                <a class="source" href="effect-clip.html">
                  effect-clip.js
                </a>
              
                
                <a class="source" href="effect-drop.html">
                  effect-drop.js
                </a>
              
                
                <a class="source" href="effect-explode.html">
                  effect-explode.js
                </a>
              
                
                <a class="source" href="effect-fade.html">
                  effect-fade.js
                </a>
              
                
                <a class="source" href="effect-fold.html">
                  effect-fold.js
                </a>
              
                
                <a class="source" href="effect-highlight.html">
                  effect-highlight.js
                </a>
              
                
                <a class="source" href="effect-puff.html">
                  effect-puff.js
                </a>
              
                
                <a class="source" href="effect-pulsate.html">
                  effect-pulsate.js
                </a>
              
                
                <a class="source" href="effect-scale.html">
                  effect-scale.js
                </a>
              
                
                <a class="source" href="effect-shake.html">
                  effect-shake.js
                </a>
              
                
                <a class="source" href="effect-size.html">
                  effect-size.js
                </a>
              
                
                <a class="source" href="effect-slide.html">
                  effect-slide.js
                </a>
              
                
                <a class="source" href="effect-transfer.html">
                  effect-transfer.js
                </a>
              
                
                <a class="source" href="effect.html">
                  effect.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="position.html">
                  position.js
                </a>
              
                
                <a class="source" href="progressbar.html">
                  progressbar.js
                </a>
              
                
                <a class="source" href="resizable.html">
                  resizable.js
                </a>
              
                
                <a class="source" href="selectable.html">
                  selectable.js
                </a>
              
                
                <a class="source" href="selectmenu.html">
                  selectmenu.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="sortable.html">
                  sortable.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="widget.html">
                  widget.js
                </a>
              
                
                <a class="source" href="json2.html">
                  json2.js
                </a>
              
                
                <a class="source" href="masonry.min.html">
                  masonry.min.js
                </a>
              
                
                <a class="source" href="mce-view.html">
                  mce-view.js
                </a>
              
                
                <a class="source" href="media-audiovideo.html">
                  media-audiovideo.js
                </a>
              
                
                <a class="source" href="media-editor.html">
                  media-editor.js
                </a>
              
                
                <a class="source" href="media-grid.html">
                  media-grid.js
                </a>
              
                
                <a class="source" href="media-models.html">
                  media-models.js
                </a>
              
                
                <a class="source" href="media-views.html">
                  media-views.js
                </a>
              
                
                <a class="source" href="audiovideo.manifest.html">
                  audiovideo.manifest.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="collection-add.html">
                  collection-add.js
                </a>
              
                
                <a class="source" href="collection-edit.html">
                  collection-edit.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-image-cropper.html">
                  customize-image-cropper.js
                </a>
              
                
                <a class="source" href="edit-attachment-metadata.html">
                  edit-attachment-metadata.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="featured-image.html">
                  featured-image.js
                </a>
              
                
                <a class="source" href="gallery-add.html">
                  gallery-add.js
                </a>
              
                
                <a class="source" href="gallery-edit.html">
                  gallery-edit.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="media-library.html">
                  media-library.js
                </a>
              
                
                <a class="source" href="region.html">
                  region.js
                </a>
              
                
                <a class="source" href="replace-image.html">
                  replace-image.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="state-machine.html">
                  state-machine.js
                </a>
              
                
                <a class="source" href="state.html">
                  state.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="grid.manifest.html">
                  grid.manifest.js
                </a>
              
                
                <a class="source" href="models.manifest.html">
                  models.manifest.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="post-image.html">
                  post-image.js
                </a>
              
                
                <a class="source" href="post-media.html">
                  post-media.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="selection-sync.html">
                  selection-sync.js
                </a>
              
                
                <a class="source" href="views.manifest.html">
                  views.manifest.js
                </a>
              
                
                <a class="source" href="attachment-compat.html">
                  attachment-compat.js
                </a>
              
                
                <a class="source" href="attachment-filters.html">
                  attachment-filters.js
                </a>
              
                
                <a class="source" href="all.html">
                  all.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="uploaded.html">
                  uploaded.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="details-two-column.html">
                  details-two-column.js
                </a>
              
                
                <a class="source" href="details.html">
                  details.js
                </a>
              
                
                <a class="source" href="edit-library.html">
                  edit-library.js
                </a>
              
                
                <a class="source" href="edit-selection.html">
                  edit-selection.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="browser.html">
                  browser.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="button-group.html">
                  button-group.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="delete-selected-permanently.html">
                  delete-selected-permanently.js
                </a>
              
                
                <a class="source" href="delete-selected.html">
                  delete-selected.js
                </a>
              
                
                <a class="source" href="select-mode-toggle.html">
                  select-mode-toggle.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="edit-image-details.html">
                  edit-image-details.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="image.html">
                  image.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="url.html">
                  url.js
                </a>
              
                
                <a class="source" href="focus-manager.html">
                  focus-manager.js
                </a>
              
                
                <a class="source" href="frame.html">
                  frame.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="edit-attachments.html">
                  edit-attachments.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="iframe.html">
                  iframe.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="label.html">
                  label.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="media-frame.html">
                  media-frame.js
                </a>
              
                
                <a class="source" href="menu-item.html">
                  menu-item.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="priority-list.html">
                  priority-list.js
                </a>
              
                
                <a class="source" href="router-item.html">
                  router-item.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="attachment-display.html">
                  attachment-display.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="playlist.html">
                  playlist.js
                </a>
              
                
                <a class="source" href="sidebar.html">
                  sidebar.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="site-icon-preview.html">
                  site-icon-preview.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="toolbar.html">
                  toolbar.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="inline.html">
                  inline.js
                </a>
              
                
                <a class="source" href="status-error.html">
                  status-error.js
                </a>
              
                
                <a class="source" href="status.html">
                  status.js
                </a>
              
                
                <a class="source" href="window.html">
                  window.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="view.html">
                  view.js
                </a>
              
                
                <a class="source" href="froogaloop.min.html">
                  froogaloop.min.js
                </a>
              
                
                <a class="source" href="mediaelement-and-player.min.html">
                  mediaelement-and-player.min.js
                </a>
              
                
                <a class="source" href="wp-mediaelement.html">
                  wp-mediaelement.js
                </a>
              
                
                <a class="source" href="wp-playlist.html">
                  wp-playlist.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="plupload.full.min.html">
                  plupload.full.min.js
                </a>
              
                
                <a class="source" href="wp-plupload.html">
                  wp-plupload.js
                </a>
              
                
                <a class="source" href="quicktags.html">
                  quicktags.js
                </a>
              
                
                <a class="source" href="shortcode.html">
                  shortcode.js
                </a>
              
                
                <a class="source" href="swfobject.html">
                  swfobject.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="handlers.min.html">
                  handlers.min.js
                </a>
              
                
                <a class="source" href="swfupload.cookies.html">
                  swfupload.cookies.js
                </a>
              
                
                <a class="source" href="swfupload.queue.html">
                  swfupload.queue.js
                </a>
              
                
                <a class="source" href="swfupload.speed.html">
                  swfupload.speed.js
                </a>
              
                
                <a class="source" href="swfupload.swfobject.html">
                  swfupload.swfobject.js
                </a>
              
                
                <a class="source" href="swfupload.html">
                  swfupload.js
                </a>
              
                
                <a class="source" href="thickbox.html">
                  thickbox.js
                </a>
              
                
                <a class="source" href="wp-langs-en.html">
                  wp-langs-en.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="tiny_mce_popup.html">
                  tiny_mce_popup.js
                </a>
              
                
                <a class="source" href="tinymce.html">
                  tinymce.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="editable_selects.html">
                  editable_selects.js
                </a>
              
                
                <a class="source" href="form_utils.html">
                  form_utils.js
                </a>
              
                
                <a class="source" href="mctabs.html">
                  mctabs.js
                </a>
              
                
                <a class="source" href="validate.html">
                  validate.js
                </a>
              
                
                <a class="source" href="tw-sack.html">
                  tw-sack.js
                </a>
              
                
                <a class="source" href="twemoji.html">
                  twemoji.js
                </a>
              
                
                <a class="source" href="underscore.html">
                  underscore.js
                </a>
              
                
                <a class="source" href="underscore.min.html">
                  underscore.min.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="wp-a11y.html">
                  wp-a11y.js
                </a>
              
                
                <a class="source" href="wp-ajax-response.html">
                  wp-ajax-response.js
                </a>
              
                
                <a class="source" href="wp-api.html">
                  wp-api.js
                </a>
              
                
                <a class="source" href="wp-auth-check.html">
                  wp-auth-check.js
                </a>
              
                
                <a class="source" href="wp-backbone.html">
                  wp-backbone.js
                </a>
              
                
                <a class="source" href="wp-custom-header.html">
                  wp-custom-header.js
                </a>
              
                
                <a class="source" href="wp-embed-template.html">
                  wp-embed-template.js
                </a>
              
                
                <a class="source" href="wp-embed.html">
                  wp-embed.js
                </a>
              
                
                <a class="source" href="wp-emoji-loader.html">
                  wp-emoji-loader.js
                </a>
              
                
                <a class="source" href="wp-emoji.html">
                  wp-emoji.js
                </a>
              
                
                <a class="source" href="wp-list-revisions.html">
                  wp-list-revisions.js
                </a>
              
                
                <a class="source" href="wp-lists.html">
                  wp-lists.js
                </a>
              
                
                <a class="source" href="wp-pointer.html">
                  wp-pointer.js
                </a>
              
                
                <a class="source" href="wp-util.html">
                  wp-util.js
                </a>
              
                
                <a class="source" href="wpdialog.html">
                  wpdialog.js
                </a>
              
                
                <a class="source" href="wplink.html">
                  wplink.js
                </a>
              
                
                <a class="source" href="zxcvbn-async.html">
                  zxcvbn-async.js
                </a>
              
                
                <a class="source" href="zxcvbn.min.html">
                  zxcvbn.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>image-edit.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global imageEditL10n, ajaxurl, confirm */</span>
<span class="hljs-comment">/**
 * @summary   The functions necessary for editing images.
 *
 * @since     2.9.0
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{

	<span class="hljs-comment">/**
	 * Contains all the methods to initialise and control the image editor.
	 *
	 * @namespace imageEdit
	 */</span>
	<span class="hljs-keyword">var</span> imageEdit = <span class="hljs-built_in">window</span>.imageEdit = {
	<span class="hljs-attr">iasapi</span> : {},
	<span class="hljs-attr">hold</span> : {},
	<span class="hljs-attr">postid</span> : <span class="hljs-string">''</span>,
	<span class="hljs-attr">_view</span> : <span class="hljs-literal">false</span>,

	<span class="hljs-comment">/**
	 * @summary Converts a value to an integer.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} f The float value that should be converted.
	 *
	 * @return {number} The integer representation from the float value.
	 */</span>
	intval : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
		<span class="hljs-comment">/*
		 * Bitwise OR operator: one of the obscure ways to truncate floating point figures,
		 * worth reminding JavaScript doesn't have a distinct "integer" type.
		 */</span>
		<span class="hljs-keyword">return</span> f | <span class="hljs-number">0</span>;
	},

	<span class="hljs-comment">/**
	 * @summary Adds the disabled attribute and class to a single form element
	 *          or a field set.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {jQuery}         el The element that should be modified.
	 * @param {bool|number}    s  The state for the element. If set to true
	 *                            the element is disabled,
	 *                            otherwise the element is enabled.
	 *                            The function is sometimes called with a 0 or 1
	 *                            instead of true or false.
	 *
	 * @returns {void}
	 */</span>
	setDisabled : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> el, s </span>) </span>{
		<span class="hljs-comment">/*
		 * `el` can be a single form element or a fieldset. Before #28864, the disabled state on
		 * some text fields  was handled targeting $('input', el). Now we need to handle the
		 * disabled state on buttons too so we can just target `el` regardless if it's a single
		 * element or a fieldset because when a fieldset is disabled, its descendants are disabled too.
		 */</span>
		<span class="hljs-keyword">if</span> ( s ) {
			el.removeClass( <span class="hljs-string">'disabled'</span> ).prop( <span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span> );
		} <span class="hljs-keyword">else</span> {
			el.addClass( <span class="hljs-string">'disabled'</span> ).prop( <span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span> );
		}
	},

	<span class="hljs-comment">/**
	 * @summary Initializes the image editor.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 *
	 * @returns {void}
	 */</span>
	init : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>, old = $(<span class="hljs-string">'#image-editor-'</span> + t.postid),
			x = t.intval( $(<span class="hljs-string">'#imgedit-x-'</span> + postid).val() ),
			y = t.intval( $(<span class="hljs-string">'#imgedit-y-'</span> + postid).val() );

		<span class="hljs-keyword">if</span> ( t.postid !== postid &amp;&amp; old.length ) {
			t.close(t.postid);
		}

		t.hold.w = t.hold.ow = x;
		t.hold.h = t.hold.oh = y;
		t.hold.xy_ratio = x / y;
		t.hold.sizer = <span class="hljs-built_in">parseFloat</span>( $(<span class="hljs-string">'#imgedit-sizer-'</span> + postid).val() );
		t.postid = postid;
		$(<span class="hljs-string">'#imgedit-response-'</span> + postid).empty();

		$(<span class="hljs-string">'input[type="text"]'</span>, <span class="hljs-string">'#imgedit-panel-'</span> + postid).keypress(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
			<span class="hljs-keyword">var</span> k = e.keyCode;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Key codes 37 thru 40 are the arrow keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-number">36</span> &lt; k &amp;&amp; k &lt; <span class="hljs-number">41</span> ) {
				$(<span class="hljs-keyword">this</span>).blur();
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The key code 13 is the enter key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-number">13</span> === k ) {
				e.preventDefault();
				e.stopPropagation();
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
		});
	},

	<span class="hljs-comment">/**
	 * @summary Toggles the wait/load icon in the editor.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 * @param {number} toggle Is 0 or 1, fades the icon in then 1 and out when 0.
	 *
	 * @returns {void}
	 */</span>
	toggleEditor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, toggle</span>) </span>{
		<span class="hljs-keyword">var</span> wait = $(<span class="hljs-string">'#imgedit-wait-'</span> + postid);

		<span class="hljs-keyword">if</span> ( toggle ) {
			wait.fadeIn( <span class="hljs-string">'fast'</span> );
		} <span class="hljs-keyword">else</span> {
			wait.fadeOut(<span class="hljs-string">'fast'</span>);
		}
	},

	<span class="hljs-comment">/**
	 * @summary Shows or hides the image edit help box.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {HTMLElement} el The element to create the help window in.
	 *
	 * @returns {boolean} Always returns false.
	 */</span>
	toggleHelp : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>) </span>{
		<span class="hljs-keyword">var</span> $el = $( el );
		$el
			.attr( <span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'false'</span> === $el.attr( <span class="hljs-string">'aria-expanded'</span> ) ? <span class="hljs-string">'true'</span> : <span class="hljs-string">'false'</span> )
			.parents( <span class="hljs-string">'.imgedit-group-top'</span> ).toggleClass( <span class="hljs-string">'imgedit-help-toggled'</span> ).find( <span class="hljs-string">'.imgedit-help'</span> ).slideToggle( <span class="hljs-string">'fast'</span> );

		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	},

	<span class="hljs-comment">/**
	 * @summary Gets the value from the image edit target.
	 *
	 * The image edit target contains the image sizes where the (possible) changes
	 * have to be applied to.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 *
	 * @returns {string} The value from the imagedit-save-target input field when available,
	 *                   or 'full' when not available.
	 */</span>
	getTarget : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid</span>) </span>{
		<span class="hljs-keyword">return</span> $(<span class="hljs-string">'input[name="imgedit-target-'</span> + postid + <span class="hljs-string">'"]:checked'</span>, <span class="hljs-string">'#imgedit-save-target-'</span> + postid).val() || <span class="hljs-string">'full'</span>;
	},

	<span class="hljs-comment">/**
	 * @summary Recalculates the height or width and keeps the original aspect ratio.
	 *
	 * If the original image size is exceeded a red exclamation mark is shown.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number}         postid The current post id.
	 * @param {number}         x      Is 0 when it applies the y-axis
	 *                                and 1 when applicable for the x-axis.
	 * @param {jQuery}         el     Element.
	 *
	 * @returns {void}
	 */</span>
	scaleChanged : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> postid, x, el </span>) </span>{
		<span class="hljs-keyword">var</span> w = $(<span class="hljs-string">'#imgedit-scale-width-'</span> + postid), h = $(<span class="hljs-string">'#imgedit-scale-height-'</span> + postid),
		warn = $(<span class="hljs-string">'#imgedit-scale-warn-'</span> + postid), w1 = <span class="hljs-string">''</span>, h1 = <span class="hljs-string">''</span>;

		<span class="hljs-keyword">if</span> ( <span class="hljs-literal">false</span> === <span class="hljs-keyword">this</span>.validateNumeric( el ) ) {
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">if</span> ( x ) {
			h1 = ( w.val() !== <span class="hljs-string">''</span> ) ? <span class="hljs-built_in">Math</span>.round( w.val() / <span class="hljs-keyword">this</span>.hold.xy_ratio ) : <span class="hljs-string">''</span>;
			h.val( h1 );
		} <span class="hljs-keyword">else</span> {
			w1 = ( h.val() !== <span class="hljs-string">''</span> ) ? <span class="hljs-built_in">Math</span>.round( h.val() * <span class="hljs-keyword">this</span>.hold.xy_ratio ) : <span class="hljs-string">''</span>;
			w.val( w1 );
		}

		<span class="hljs-keyword">if</span> ( ( h1 &amp;&amp; h1 &gt; <span class="hljs-keyword">this</span>.hold.oh ) || ( w1 &amp;&amp; w1 &gt; <span class="hljs-keyword">this</span>.hold.ow ) ) {
			warn.css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'visible'</span>);
		} <span class="hljs-keyword">else</span> {
			warn.css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'hidden'</span>);
		}
	},

	<span class="hljs-comment">/**
	 * @summary Gets the selected aspect ratio.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 *
	 * @returns {string} The aspect ratio.
	 */</span>
	getSelRatio : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid</span>) </span>{
		<span class="hljs-keyword">var</span> x = <span class="hljs-keyword">this</span>.hold.w, y = <span class="hljs-keyword">this</span>.hold.h,
			X = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-crop-width-'</span> + postid).val() ),
			Y = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-crop-height-'</span> + postid).val() );

		<span class="hljs-keyword">if</span> ( X &amp;&amp; Y ) {
			<span class="hljs-keyword">return</span> X + <span class="hljs-string">':'</span> + Y;
		}

		<span class="hljs-keyword">if</span> ( x &amp;&amp; y ) {
			<span class="hljs-keyword">return</span> x + <span class="hljs-string">':'</span> + y;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-string">'1:1'</span>;
	},

	<span class="hljs-comment">/**
	 * @summary Removes the last action from the image edit history
	 * The history consist of (edit) actions performed on the image.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid  The post id.
	 * @param {number} setSize 0 or 1, when 1 the image resets to its original size.
	 *
	 * @returns {string} JSON string containing the history or an empty string if no history exists.
	 */</span>
	filterHistory : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, setSize</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Apply undo state to history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> history = $(<span class="hljs-string">'#imgedit-history-'</span> + postid).val(), pop, n, o, i, op = [];

		<span class="hljs-keyword">if</span> ( history !== <span class="hljs-string">''</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Read the JSON string with the image edit history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			history = <span class="hljs-built_in">JSON</span>.parse(history);
			pop = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-undone-'</span> + postid).val() );
			<span class="hljs-keyword">if</span> ( pop &gt; <span class="hljs-number">0</span> ) {
				<span class="hljs-keyword">while</span> ( pop &gt; <span class="hljs-number">0</span> ) {
					history.pop();
					pop--;
				}
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Reset size to its original state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( setSize ) {
				<span class="hljs-keyword">if</span> ( !history.length ) {
					<span class="hljs-keyword">this</span>.hold.w = <span class="hljs-keyword">this</span>.hold.ow;
					<span class="hljs-keyword">this</span>.hold.h = <span class="hljs-keyword">this</span>.hold.oh;
					<span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Restore original o.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				o = history[history.length - <span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>c = crop, r = rotate, f = flip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				o = o.c || o.r || o.f || <span class="hljs-literal">false</span>;

				<span class="hljs-keyword">if</span> ( o ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>fw = Full image width</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">this</span>.hold.w = o.fw;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>fh = Full image height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">this</span>.hold.h = o.fh;
				}
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Filter the last step/action from the history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">for</span> ( n <span class="hljs-keyword">in</span> history ) {
				i = history[n];
				<span class="hljs-keyword">if</span> ( i.hasOwnProperty(<span class="hljs-string">'c'</span>) ) {
					op[n] = { <span class="hljs-string">'c'</span>: { <span class="hljs-string">'x'</span>: i.c.x, <span class="hljs-string">'y'</span>: i.c.y, <span class="hljs-string">'w'</span>: i.c.w, <span class="hljs-string">'h'</span>: i.c.h } };
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( i.hasOwnProperty(<span class="hljs-string">'r'</span>) ) {
					op[n] = { <span class="hljs-string">'r'</span>: i.r.r };
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( i.hasOwnProperty(<span class="hljs-string">'f'</span>) ) {
					op[n] = { <span class="hljs-string">'f'</span>: i.f.f };
				}
			}
			<span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(op);
		}
		<span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
	},
	<span class="hljs-comment">/**
	 * @summary Binds the necessary events to the image.
	 *
	 * When the image source is reloaded the image will be reloaded.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number}   postid   The post id.
	 * @param {string}   nonce    The nonce to verify the request.
	 * @param {function} callback Function to execute when the image is loaded.
	 *
	 * @returns {void}
	 */</span>
	refreshEditor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, nonce, callback</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>, data, img;

		t.toggleEditor(postid, <span class="hljs-number">1</span>);
		data = {
			<span class="hljs-string">'action'</span>: <span class="hljs-string">'imgedit-preview'</span>,
			<span class="hljs-string">'_ajax_nonce'</span>: nonce,
			<span class="hljs-string">'postid'</span>: postid,
			<span class="hljs-string">'history'</span>: t.filterHistory(postid, <span class="hljs-number">1</span>),
			<span class="hljs-string">'rand'</span>: t.intval(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">1000000</span>)
		};

		img = $( <span class="hljs-string">'&lt;img id="image-preview-'</span> + postid + <span class="hljs-string">'" alt="" /&gt;'</span> )
			.on( <span class="hljs-string">'load'</span>, { <span class="hljs-attr">history</span>: data.history }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
				<span class="hljs-keyword">var</span> max1, max2,
					parent = $( <span class="hljs-string">'#imgedit-crop-'</span> + postid ),
					t = imageEdit,
					historyObj;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Checks if there already is some image-edit history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( <span class="hljs-string">''</span> !== event.data.history ) {
					historyObj = <span class="hljs-built_in">JSON</span>.parse( event.data.history );</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If last executed action in history is a crop action.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( historyObj[historyObj.length - <span class="hljs-number">1</span>].hasOwnProperty( <span class="hljs-string">'c'</span> ) ) {
						<span class="hljs-comment">/*
						 * A crop action has completed and the crop button gets disabled
						 * ensure the undo button is enabled.
						 */</span>
						t.setDisabled( $( <span class="hljs-string">'#image-undo-'</span> + postid) , <span class="hljs-literal">true</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Move focus to the undo button to avoid a focus loss.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						$( <span class="hljs-string">'#image-undo-'</span> + postid ).focus();
					}
				}

				parent.empty().append(img);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>w, h are the new full size dims</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				max1 = <span class="hljs-built_in">Math</span>.max( t.hold.w, t.hold.h );
				max2 = <span class="hljs-built_in">Math</span>.max( $(img).width(), $(img).height() );
				t.hold.sizer = max1 &gt; max2 ? max2 / max1 : <span class="hljs-number">1</span>;

				t.initCrop(postid, img, parent);
				t.setCropSelection(postid, <span class="hljs-number">0</span>);

				<span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">'undefined'</span>) &amp;&amp; callback !== <span class="hljs-literal">null</span> ) {
					callback();
				}

				<span class="hljs-keyword">if</span> ( $(<span class="hljs-string">'#imgedit-history-'</span> + postid).val() &amp;&amp; $(<span class="hljs-string">'#imgedit-undone-'</span> + postid).val() === <span class="hljs-string">'0'</span> ) {
					$(<span class="hljs-string">'input.imgedit-submit-btn'</span>, <span class="hljs-string">'#imgedit-panel-'</span> + postid).removeAttr(<span class="hljs-string">'disabled'</span>);
				} <span class="hljs-keyword">else</span> {
					$(<span class="hljs-string">'input.imgedit-submit-btn'</span>, <span class="hljs-string">'#imgedit-panel-'</span> + postid).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span>);
				}

				t.toggleEditor(postid, <span class="hljs-number">0</span>);
			})
			.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$(<span class="hljs-string">'#imgedit-crop-'</span> + postid).empty().append(<span class="hljs-string">'&lt;div class="error"&gt;&lt;p&gt;'</span> + imageEditL10n.error + <span class="hljs-string">'&lt;/p&gt;&lt;/div&gt;'</span>);
				t.toggleEditor(postid, <span class="hljs-number">0</span>);
			})
			.attr(<span class="hljs-string">'src'</span>, ajaxurl + <span class="hljs-string">'?'</span> + $.param(data));
	},
	<span class="hljs-comment">/**
	 * @summary Performs an image edit action.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param  {number}  postid The post id.
	 * @param  {string}  nonce  The nonce to verify the request.
	 * @param  {string}  action The action to perform on the image.
	 *                          The possible actions are: "scale" and "restore".
	 *
	 * @returns {boolean|void} Executes a post request that refreshes the page
	 *                         when the action is performed.
	 *                         Returns false if a invalid action is given,
	 *                         or when the action cannot be performed.
	 */</span>
	action : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, nonce, action</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>, data, w, h, fw, fh;

		<span class="hljs-keyword">if</span> ( t.notsaved(postid) ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		data = {
			<span class="hljs-string">'action'</span>: <span class="hljs-string">'image-editor'</span>,
			<span class="hljs-string">'_ajax_nonce'</span>: nonce,
			<span class="hljs-string">'postid'</span>: postid
		};

		<span class="hljs-keyword">if</span> ( <span class="hljs-string">'scale'</span> === action ) {
			w = $(<span class="hljs-string">'#imgedit-scale-width-'</span> + postid),
			h = $(<span class="hljs-string">'#imgedit-scale-height-'</span> + postid),
			fw = t.intval(w.val()),
			fh = t.intval(h.val());

			<span class="hljs-keyword">if</span> ( fw &lt; <span class="hljs-number">1</span> ) {
				w.focus();
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( fh &lt; <span class="hljs-number">1</span> ) {
				h.focus();
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}

			<span class="hljs-keyword">if</span> ( fw === t.hold.ow || fh === t.hold.oh ) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}

			data[<span class="hljs-string">'do'</span>] = <span class="hljs-string">'scale'</span>;
			data.fwidth = fw;
			data.fheight = fh;
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-string">'restore'</span> === action ) {
			data[<span class="hljs-string">'do'</span>] = <span class="hljs-string">'restore'</span>;
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		t.toggleEditor(postid, <span class="hljs-number">1</span>);
		$.post(ajaxurl, data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>) </span>{
			$(<span class="hljs-string">'#image-editor-'</span> + postid).empty().append(r);
			t.toggleEditor(postid, <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>refresh the attachment model so that changes propagate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( t._view ) {
				t._view.refresh();
			}
		});
	},

	<span class="hljs-comment">/**
	 * @summary Stores the changes that are made to the image.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number}  postid   The post id to get the image from the database.
	 * @param {string}  nonce    The nonce to verify the request.
	 *
	 * @returns {boolean|void}  If the actions are successfully saved a response message is shown.
	 *                          Returns false if there is no image editing history,
	 *                          thus there are not edit-actions performed on the image.
	 */</span>
	save : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, nonce</span>) </span>{
		<span class="hljs-keyword">var</span> data,
			target = <span class="hljs-keyword">this</span>.getTarget(postid),
			history = <span class="hljs-keyword">this</span>.filterHistory(postid, <span class="hljs-number">0</span>),
			self = <span class="hljs-keyword">this</span>;

		<span class="hljs-keyword">if</span> ( <span class="hljs-string">''</span> === history ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">this</span>.toggleEditor(postid, <span class="hljs-number">1</span>);
		data = {
			<span class="hljs-string">'action'</span>: <span class="hljs-string">'image-editor'</span>,
			<span class="hljs-string">'_ajax_nonce'</span>: nonce,
			<span class="hljs-string">'postid'</span>: postid,
			<span class="hljs-string">'history'</span>: history,
			<span class="hljs-string">'target'</span>: target,
			<span class="hljs-string">'context'</span>: $(<span class="hljs-string">'#image-edit-context'</span>).length ? $(<span class="hljs-string">'#image-edit-context'</span>).val() : <span class="hljs-literal">null</span>,
			<span class="hljs-string">'do'</span>: <span class="hljs-string">'save'</span>
		};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Post the image edit data to the backend.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$.post(ajaxurl, data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Read the response.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> ret = <span class="hljs-built_in">JSON</span>.parse(r);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If a response is returned, close the editor and show an error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( ret.error ) {
				$(<span class="hljs-string">'#imgedit-response-'</span> + postid).html(<span class="hljs-string">'&lt;div class="error"&gt;&lt;p&gt;'</span> + ret.error + <span class="hljs-string">'&lt;/p&gt;&lt;/div&gt;'</span>);
				imageEdit.close(postid);
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">if</span> ( ret.fw &amp;&amp; ret.fh ) {
				$(<span class="hljs-string">'#media-dims-'</span> + postid).html( ret.fw + <span class="hljs-string">' &amp;times; '</span> + ret.fh );
			}

			<span class="hljs-keyword">if</span> ( ret.thumbnail ) {
				$(<span class="hljs-string">'.thumbnail'</span>, <span class="hljs-string">'#thumbnail-head-'</span> + postid).attr(<span class="hljs-string">'src'</span>, <span class="hljs-string">''</span>+ret.thumbnail);
			}

			<span class="hljs-keyword">if</span> ( ret.msg ) {
				$(<span class="hljs-string">'#imgedit-response-'</span> + postid).html(<span class="hljs-string">'&lt;div class="updated"&gt;&lt;p&gt;'</span> + ret.msg + <span class="hljs-string">'&lt;/p&gt;&lt;/div&gt;'</span>);
			}

			<span class="hljs-keyword">if</span> ( self._view ) {
				self._view.save();
			} <span class="hljs-keyword">else</span> {
				imageEdit.close(postid);
			}
		});
	},

	<span class="hljs-comment">/**
	 * @summary Creates the image edit window.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid   The post id for the image.
	 * @param {string} nonce    The nonce to verify the request.
	 * @param {object} view     The image editor view to be used for the editing.
	 *
	 * @returns {void|promise} Either returns void if the button was already activated
	 *                         or returns an instance of the image editor, wrapped in a promise.
	 */</span>
	open : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> postid, nonce, view </span>) </span>{
		<span class="hljs-keyword">this</span>._view = view;

		<span class="hljs-keyword">var</span> dfd, data, elem = $(<span class="hljs-string">'#image-editor-'</span> + postid), head = $(<span class="hljs-string">'#media-head-'</span> + postid),
			btn = $(<span class="hljs-string">'#imgedit-open-btn-'</span> + postid), spin = btn.siblings(<span class="hljs-string">'.spinner'</span>);

		<span class="hljs-comment">/*
		 * Instead of disabling the button, which causes a focus loss and makes screen
		 * readers announce "unavailable", return if the button was already clicked.
		 */</span>
		<span class="hljs-keyword">if</span> ( btn.hasClass( <span class="hljs-string">'button-activated'</span> ) ) {
			<span class="hljs-keyword">return</span>;
		}

		spin.addClass( <span class="hljs-string">'is-active'</span> );

		data = {
			<span class="hljs-string">'action'</span>: <span class="hljs-string">'image-editor'</span>,
			<span class="hljs-string">'_ajax_nonce'</span>: nonce,
			<span class="hljs-string">'postid'</span>: postid,
			<span class="hljs-string">'do'</span>: <span class="hljs-string">'open'</span>
		};

		dfd = $.ajax({
			<span class="hljs-attr">url</span>:  ajaxurl,
			<span class="hljs-attr">type</span>: <span class="hljs-string">'post'</span>,
			<span class="hljs-attr">data</span>: data,
			<span class="hljs-attr">beforeSend</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				btn.addClass( <span class="hljs-string">'button-activated'</span> );
			}
		}).done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> html </span>) </span>{
			elem.html( html );
			head.fadeOut(<span class="hljs-string">'fast'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
				elem.fadeIn(<span class="hljs-string">'fast'</span>);
				btn.removeClass( <span class="hljs-string">'button-activated'</span> );
				spin.removeClass( <span class="hljs-string">'is-active'</span> );
			});</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Initialise the Image Editor now that everything is ready.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			imageEdit.init( postid );
		});

		<span class="hljs-keyword">return</span> dfd;
	},

	<span class="hljs-comment">/**
	 * @summary Initializes the cropping tool and sets a default cropping selection.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 *
	 * @returns {void}
	 */</span>
	imgLoaded : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid</span>) </span>{
		<span class="hljs-keyword">var</span> img = $(<span class="hljs-string">'#image-preview-'</span> + postid), parent = $(<span class="hljs-string">'#imgedit-crop-'</span> + postid);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Ensure init has run even when directly loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( <span class="hljs-string">'undefined'</span> === <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.hold.sizer ) {
			<span class="hljs-keyword">this</span>.init( postid );
		}

		<span class="hljs-keyword">this</span>.initCrop(postid, img, parent);
		<span class="hljs-keyword">this</span>.setCropSelection(postid, <span class="hljs-number">0</span>);
		<span class="hljs-keyword">this</span>.toggleEditor(postid, <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Editor is ready, move focus to the first focusable element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$( <span class="hljs-string">'.imgedit-wrap .imgedit-help-toggle'</span> ).eq( <span class="hljs-number">0</span> ).focus();
	},

	<span class="hljs-comment">/**
	 * @summary Initializes the cropping tool.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number}      postid The post id.
	 * @param {HTMLElement} image  The preview image.
	 * @param {HTMLElement} parent The preview image container.
	 *
	 * @returns {void}
	 */</span>
	initCrop : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, image, parent</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>,
			selW = $(<span class="hljs-string">'#imgedit-sel-width-'</span> + postid),
			selH = $(<span class="hljs-string">'#imgedit-sel-height-'</span> + postid),
			$img;

		t.iasapi = $(image).imgAreaSelect({
			<span class="hljs-attr">parent</span>: parent,
			<span class="hljs-attr">instance</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">handles</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">keys</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">minWidth</span>: <span class="hljs-number">3</span>,
			<span class="hljs-attr">minHeight</span>: <span class="hljs-number">3</span>,

			<span class="hljs-comment">/**
			 * @summary Sets the CSS styles and binds events for locking the aspect ratio.
			 *
			 * @param {jQuery} img The preview image.
			 */</span>
			onInit: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> img </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Ensure that the imgAreaSelect wrapper elements are position:absolute.
(even if were in a position:fixed modal)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$img = $( img );
				$img.next().css( <span class="hljs-string">'position'</span>, <span class="hljs-string">'absolute'</span> )
					.nextAll( <span class="hljs-string">'.imgareaselect-outer'</span> ).css( <span class="hljs-string">'position'</span>, <span class="hljs-string">'absolute'</span> );
				<span class="hljs-comment">/**
				 * @summary Binds mouse down event to the cropping container.
				 *
				 * @returns {void}
				 */</span>
				parent.children().mousedown(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
					<span class="hljs-keyword">var</span> ratio = <span class="hljs-literal">false</span>, sel, defRatio;

					<span class="hljs-keyword">if</span> ( e.shiftKey ) {
						sel = t.iasapi.getSelection();
						defRatio = t.getSelRatio(postid);
						ratio = ( sel &amp;&amp; sel.width &amp;&amp; sel.height ) ? sel.width + <span class="hljs-string">':'</span> + sel.height : defRatio;
					}

					t.iasapi.setOptions({
						<span class="hljs-attr">aspectRatio</span>: ratio
					});
				});
			},

			<span class="hljs-comment">/**
			 * @summary Event triggered when starting a selection.
			 *
			 * @returns {void}
			 */</span>
			onSelectStart: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				imageEdit.setDisabled($(<span class="hljs-string">'#imgedit-crop-sel-'</span> + postid), <span class="hljs-number">1</span>);
			},
			<span class="hljs-comment">/**
			 * @summary Event triggered when the selection is ended.
			 *
			 * @param {object} img jQuery object representing the image.
			 * @param {object} c   The selection.
			 *
			 * @returns {object}
			 */</span>
			onSelectEnd: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">img, c</span>) </span>{
				imageEdit.setCropSelection(postid, c);
			},

			<span class="hljs-comment">/**
			 * @summary Event triggered when the selection changes.
			 *
			 * @param {object} img jQuery object representing the image.
			 * @param {object} c   The selection.
			 *
			 * @returns {void}
			 */</span>
			onSelectChange: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">img, c</span>) </span>{
				<span class="hljs-keyword">var</span> sizer = imageEdit.hold.sizer;
				selW.val( imageEdit.round(c.width / sizer) );
				selH.val( imageEdit.round(c.height / sizer) );
			}
		});
	},

	<span class="hljs-comment">/**
	 * @summary Stores the current crop selection.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 * @param {object} c      The selection.
	 *
	 * @returns {boolean}
	 */</span>
	setCropSelection : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, c</span>) </span>{
		<span class="hljs-keyword">var</span> sel;

		c = c || <span class="hljs-number">0</span>;

		<span class="hljs-keyword">if</span> ( !c || ( c.width &lt; <span class="hljs-number">3</span> &amp;&amp; c.height &lt; <span class="hljs-number">3</span> ) ) {
			<span class="hljs-keyword">this</span>.setDisabled($(<span class="hljs-string">'.imgedit-crop'</span>, <span class="hljs-string">'#imgedit-panel-'</span> + postid), <span class="hljs-number">0</span>);
			<span class="hljs-keyword">this</span>.setDisabled($(<span class="hljs-string">'#imgedit-crop-sel-'</span> + postid), <span class="hljs-number">0</span>);
			$(<span class="hljs-string">'#imgedit-sel-width-'</span> + postid).val(<span class="hljs-string">''</span>);
			$(<span class="hljs-string">'#imgedit-sel-height-'</span> + postid).val(<span class="hljs-string">''</span>);
			$(<span class="hljs-string">'#imgedit-selection-'</span> + postid).val(<span class="hljs-string">''</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		sel = { <span class="hljs-string">'x'</span>: c.x1, <span class="hljs-string">'y'</span>: c.y1, <span class="hljs-string">'w'</span>: c.width, <span class="hljs-string">'h'</span>: c.height };
		<span class="hljs-keyword">this</span>.setDisabled($(<span class="hljs-string">'.imgedit-crop'</span>, <span class="hljs-string">'#imgedit-panel-'</span> + postid), <span class="hljs-number">1</span>);
		$(<span class="hljs-string">'#imgedit-selection-'</span> + postid).val( <span class="hljs-built_in">JSON</span>.stringify(sel) );
	},


	<span class="hljs-comment">/**
	 * @summary Closes the image editor.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number}  postid The post id.
	 * @param {bool}    warn   Warning message.
	 *
	 * @returns {void|bool} Returns false if there is a warning.
	 */</span>
	close : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, warn</span>) </span>{
		warn = warn || <span class="hljs-literal">false</span>;

		<span class="hljs-keyword">if</span> ( warn &amp;&amp; <span class="hljs-keyword">this</span>.notsaved(postid) ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">this</span>.iasapi = {};
		<span class="hljs-keyword">this</span>.hold = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>If weve loaded the editor in the context of a Media Modal, then switch to the previous view,
whatever that might have been.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._view ){
			<span class="hljs-keyword">this</span>._view.back();
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>In case we are not accessing the image editor in the context of a View, close the editor the old-skool way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">else</span> {
			$(<span class="hljs-string">'#image-editor-'</span> + postid).fadeOut(<span class="hljs-string">'fast'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$( <span class="hljs-string">'#media-head-'</span> + postid ).fadeIn( <span class="hljs-string">'fast'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Move focus back to the Edit Image button. Runs also when saving.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$( <span class="hljs-string">'#imgedit-open-btn-'</span> + postid ).focus();
				});
				$(<span class="hljs-keyword">this</span>).empty();
			});
		}


	},

	<span class="hljs-comment">/**
	 * @summary Checks if the image edit history is saved.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 *
	 * @returns {boolean} Returns true if the history is not saved.
	 */</span>
	notsaved : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid</span>) </span>{
		<span class="hljs-keyword">var</span> h = $(<span class="hljs-string">'#imgedit-history-'</span> + postid).val(),
			history = ( h !== <span class="hljs-string">''</span> ) ? <span class="hljs-built_in">JSON</span>.parse(h) : [],
			pop = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-undone-'</span> + postid).val() );

		<span class="hljs-keyword">if</span> ( pop &lt; history.length ) {
			<span class="hljs-keyword">if</span> ( confirm( $(<span class="hljs-string">'#imgedit-leaving-'</span> + postid).html() ) ) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
		}
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	},

	<span class="hljs-comment">/**
	 * @summary Adds an image edit action to the history.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {object} op     The original position.
	 * @param {number} postid The post id.
	 * @param {string} nonce  The nonce.
	 *
	 * @returns {void}
	 */</span>
	addStep : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">op, postid, nonce</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>, elem = $(<span class="hljs-string">'#imgedit-history-'</span> + postid),
			history = ( elem.val() !== <span class="hljs-string">''</span> ) ? <span class="hljs-built_in">JSON</span>.parse( elem.val() ) : [],
			undone = $( <span class="hljs-string">'#imgedit-undone-'</span> + postid ),
			pop = t.intval( undone.val() );

		<span class="hljs-keyword">while</span> ( pop &gt; <span class="hljs-number">0</span> ) {
			history.pop();
			pop--;
		}
		undone.val(<span class="hljs-number">0</span>); <span class="hljs-comment">// reset</span>

		history.push(op);
		elem.val( <span class="hljs-built_in">JSON</span>.stringify(history) );

		t.refreshEditor(postid, nonce, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			t.setDisabled($(<span class="hljs-string">'#image-undo-'</span> + postid), <span class="hljs-literal">true</span>);
			t.setDisabled($(<span class="hljs-string">'#image-redo-'</span> + postid), <span class="hljs-literal">false</span>);
		});
	},

	<span class="hljs-comment">/**
	 * @summary Rotates the image.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {string} angle  The angle the image is rotated with.
	 * @param {number} postid The post id.
	 * @param {string} nonce  The nonce.
	 * @param {object} t      The target element.
	 *
	 * @returns {boolean}
	 */</span>
	rotate : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">angle, postid, nonce, t</span>) </span>{
		<span class="hljs-keyword">if</span> ( $(t).hasClass(<span class="hljs-string">'disabled'</span>) ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">this</span>.addStep({ <span class="hljs-string">'r'</span>: { <span class="hljs-string">'r'</span>: angle, <span class="hljs-string">'fw'</span>: <span class="hljs-keyword">this</span>.hold.h, <span class="hljs-string">'fh'</span>: <span class="hljs-keyword">this</span>.hold.w }}, postid, nonce);
	},

	<span class="hljs-comment">/**
	 * @summary Flips the image.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} axis   The axle the image is flipped on.
	 * @param {number} postid The post id.
	 * @param {string} nonce  The nonce.
	 * @param {object} t      The target element.
	 *
	 * @returns {boolean}
	 */</span>
	flip : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">axis, postid, nonce, t</span>) </span>{
		<span class="hljs-keyword">if</span> ( $(t).hasClass(<span class="hljs-string">'disabled'</span>) ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">this</span>.addStep({ <span class="hljs-string">'f'</span>: { <span class="hljs-string">'f'</span>: axis, <span class="hljs-string">'fw'</span>: <span class="hljs-keyword">this</span>.hold.w, <span class="hljs-string">'fh'</span>: <span class="hljs-keyword">this</span>.hold.h }}, postid, nonce);
	},

	<span class="hljs-comment">/**
	 * @summary Crops the image.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 * @param {string} nonce  The nonce.
	 * @param {object} t      The target object.
	 *
	 * @returns {void|boolean} Returns false if the crop button is disabled.
	 */</span>
	crop : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">postid, nonce, t</span>) </span>{
		<span class="hljs-keyword">var</span> sel = $(<span class="hljs-string">'#imgedit-selection-'</span> + postid).val(),
			w = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-sel-width-'</span> + postid).val() ),
			h = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-sel-height-'</span> + postid).val() );

		<span class="hljs-keyword">if</span> ( $(t).hasClass(<span class="hljs-string">'disabled'</span>) || sel === <span class="hljs-string">''</span> ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		sel = <span class="hljs-built_in">JSON</span>.parse(sel);
		<span class="hljs-keyword">if</span> ( sel.w &gt; <span class="hljs-number">0</span> &amp;&amp; sel.h &gt; <span class="hljs-number">0</span> &amp;&amp; w &gt; <span class="hljs-number">0</span> &amp;&amp; h &gt; <span class="hljs-number">0</span> ) {
			sel.fw = w;
			sel.fh = h;
			<span class="hljs-keyword">this</span>.addStep({ <span class="hljs-string">'c'</span>: sel }, postid, nonce);
		}
	},

	<span class="hljs-comment">/**
	 * @summary Undoes an image edit action.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid   The post id.
	 * @param {string} nonce    The nonce.
	 *
	 * @returns {void|false} Returns false if the undo button is disabled.
	 */</span>
	undo : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">postid, nonce</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>, button = $(<span class="hljs-string">'#image-undo-'</span> + postid), elem = $(<span class="hljs-string">'#imgedit-undone-'</span> + postid),
			pop = t.intval( elem.val() ) + <span class="hljs-number">1</span>;

		<span class="hljs-keyword">if</span> ( button.hasClass(<span class="hljs-string">'disabled'</span>) ) {
			<span class="hljs-keyword">return</span>;
		}

		elem.val(pop);
		t.refreshEditor(postid, nonce, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> elem = $(<span class="hljs-string">'#imgedit-history-'</span> + postid),
				history = ( elem.val() !== <span class="hljs-string">''</span> ) ? <span class="hljs-built_in">JSON</span>.parse( elem.val() ) : [];

			t.setDisabled($(<span class="hljs-string">'#image-redo-'</span> + postid), <span class="hljs-literal">true</span>);
			t.setDisabled(button, pop &lt; history.length);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>When undo gets disabled, move focus to the redo button to avoid a focus loss.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( history.length === pop ) {
				$( <span class="hljs-string">'#image-redo-'</span> + postid ).focus();
			}
		});
	},

	<span class="hljs-comment">/**
	 * Reverts a undo action.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 * @param {string} nonce  The nonce.
	 *
	 * @returns {void}
	 */</span>
	redo : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, nonce</span>) </span>{
		<span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>, button = $(<span class="hljs-string">'#image-redo-'</span> + postid), elem = $(<span class="hljs-string">'#imgedit-undone-'</span> + postid),
			pop = t.intval( elem.val() ) - <span class="hljs-number">1</span>;

		<span class="hljs-keyword">if</span> ( button.hasClass(<span class="hljs-string">'disabled'</span>) ) {
			<span class="hljs-keyword">return</span>;
		}

		elem.val(pop);
		t.refreshEditor(postid, nonce, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			t.setDisabled($(<span class="hljs-string">'#image-undo-'</span> + postid), <span class="hljs-literal">true</span>);
			t.setDisabled(button, pop &gt; <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>When redo gets disabled, move focus to the undo button to avoid a focus loss.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === pop ) {
				$( <span class="hljs-string">'#image-undo-'</span> + postid ).focus();
			}
		});
	},

	<span class="hljs-comment">/**
	 * @summary Sets the selection for the height and width in pixels.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid The post id.
	 * @param {jQuery} el     The element containing the values.
	 *
	 * @returns {void|boolean} Returns false when the x or y value is lower than 1,
	 *                         void when the value is not numeric or when the operation
	 *                         is successful.
	 */</span>
	setNumSelection : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> postid, el </span>) </span>{
		<span class="hljs-keyword">var</span> sel, elX = $(<span class="hljs-string">'#imgedit-sel-width-'</span> + postid), elY = $(<span class="hljs-string">'#imgedit-sel-height-'</span> + postid),
			x = <span class="hljs-keyword">this</span>.intval( elX.val() ), y = <span class="hljs-keyword">this</span>.intval( elY.val() ),
			img = $(<span class="hljs-string">'#image-preview-'</span> + postid), imgh = img.height(), imgw = img.width(),
			sizer = <span class="hljs-keyword">this</span>.hold.sizer, x1, y1, x2, y2, ias = <span class="hljs-keyword">this</span>.iasapi;

		<span class="hljs-keyword">if</span> ( <span class="hljs-literal">false</span> === <span class="hljs-keyword">this</span>.validateNumeric( el ) ) {
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">if</span> ( x &lt; <span class="hljs-number">1</span> ) {
			elX.val(<span class="hljs-string">''</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">if</span> ( y &lt; <span class="hljs-number">1</span> ) {
			elY.val(<span class="hljs-string">''</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}

		<span class="hljs-keyword">if</span> ( x &amp;&amp; y &amp;&amp; ( sel = ias.getSelection() ) ) {
			x2 = sel.x1 + <span class="hljs-built_in">Math</span>.round( x * sizer );
			y2 = sel.y1 + <span class="hljs-built_in">Math</span>.round( y * sizer );
			x1 = sel.x1;
			y1 = sel.y1;

			<span class="hljs-keyword">if</span> ( x2 &gt; imgw ) {
				x1 = <span class="hljs-number">0</span>;
				x2 = imgw;
				elX.val( <span class="hljs-built_in">Math</span>.round( x2 / sizer ) );
			}

			<span class="hljs-keyword">if</span> ( y2 &gt; imgh ) {
				y1 = <span class="hljs-number">0</span>;
				y2 = imgh;
				elY.val( <span class="hljs-built_in">Math</span>.round( y2 / sizer ) );
			}

			ias.setSelection( x1, y1, x2, y2 );
			ias.update();
			<span class="hljs-keyword">this</span>.setCropSelection(postid, ias.getSelection());
		}
	},

	<span class="hljs-comment">/**
	 * Rounds a number to a whole.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} num The number.
	 *
	 * @returns {number} The number rounded to a whole number.
	 */</span>
	round : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">num</span>) </span>{
		<span class="hljs-keyword">var</span> s;
		num = <span class="hljs-built_in">Math</span>.round(num);

		<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.hold.sizer &gt; <span class="hljs-number">0.6</span> ) {
			<span class="hljs-keyword">return</span> num;
		}

		s = num.toString().slice(<span class="hljs-number">-1</span>);

		<span class="hljs-keyword">if</span> ( <span class="hljs-string">'1'</span> === s ) {
			<span class="hljs-keyword">return</span> num - <span class="hljs-number">1</span>;
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-string">'9'</span> === s ) {
			<span class="hljs-keyword">return</span> num + <span class="hljs-number">1</span>;
		}

		<span class="hljs-keyword">return</span> num;
	},

	<span class="hljs-comment">/**
	 * Sets a locked aspect ratio for the selection.
	 *
	 * @memberof imageEdit
	 * @since    2.9.0
	 *
	 * @param {number} postid     The post id.
	 * @param {number} n          The ratio to set.
	 * @param {jQuery} el         The element containing the values.
	 *
	 * @returns {void}
	 */</span>
	setRatioSelection : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">postid, n, el</span>) </span>{
		<span class="hljs-keyword">var</span> sel, r, x = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-crop-width-'</span> + postid).val() ),
			y = <span class="hljs-keyword">this</span>.intval( $(<span class="hljs-string">'#imgedit-crop-height-'</span> + postid).val() ),
			h = $(<span class="hljs-string">'#image-preview-'</span> + postid).height();

		<span class="hljs-keyword">if</span> ( <span class="hljs-literal">false</span> === <span class="hljs-keyword">this</span>.validateNumeric( el ) ) {
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">if</span> ( x &amp;&amp; y ) {
			<span class="hljs-keyword">this</span>.iasapi.setOptions({
				<span class="hljs-attr">aspectRatio</span>: x + <span class="hljs-string">':'</span> + y
			});

			<span class="hljs-keyword">if</span> ( sel = <span class="hljs-keyword">this</span>.iasapi.getSelection(<span class="hljs-literal">true</span>) ) {
				r = <span class="hljs-built_in">Math</span>.ceil( sel.y1 + ( ( sel.x2 - sel.x1 ) / ( x / y ) ) );

				<span class="hljs-keyword">if</span> ( r &gt; h ) {
					r = h;
					<span class="hljs-keyword">if</span> ( n ) {
						$(<span class="hljs-string">'#imgedit-crop-height-'</span> + postid).val(<span class="hljs-string">''</span>);
					} <span class="hljs-keyword">else</span> {
						$(<span class="hljs-string">'#imgedit-crop-width-'</span> + postid).val(<span class="hljs-string">''</span>);
					}
				}

				<span class="hljs-keyword">this</span>.iasapi.setSelection( sel.x1, sel.y1, sel.x2, r );
				<span class="hljs-keyword">this</span>.iasapi.update();
			}
		}
	},

	<span class="hljs-comment">/**
	 * Validates if a value in a jQuery.HTMLElement is numeric.
	 *
	 * @memberof imageEdit
	 * @since    4.6
	 *
	 * @param {jQuery} el The html element.
	 *
	 * @returns {void|boolean} Returns false if the value is not numeric,
	 *                         void when it is.
	 */</span>
	validateNumeric: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> el </span>) </span>{
		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">this</span>.intval( $( el ).val() ) ) {
			$( el ).val( <span class="hljs-string">''</span> );
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}
	}
};
})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
